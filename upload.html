<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Subir imagen a Google Drive</title>
</head>
<body style="font-family: sans-serif; padding: 1em;">
  <h3>Subir comprobante</h3>
  <input type="file" id="fileInput" />
  <button id="uploadBtn">Subir imagen</button>
  <p id="status"></p>

  <script>
    const uploadBtn = document.getElementById('uploadBtn');
    const status = document.getElementById('status');

    uploadBtn.addEventListener('click', async () => {
      const fileInput = document.getElementById('fileInput');
      const file = fileInput.files[0];

      if (!file) {
        status.textContent = "Selecciona un archivo.";
        return;
      }

      status.textContent = "Subiendo imagen...";

      const reader = new FileReader();

      reader.onloadend = async () => {
        const base64 = reader.result.split(',')[1];

        try {
          const response = await fetch("https://script.google.com/macros/s/AKfycbxpx4Vevzv8jdfkmpGSDagxtXWOksvTg2N3vgblPIUyRS4ES8d_8fHOlQeO_GmlozWo/exec", {
            method: 'POST',
            headers: {
              'Content-Type': file.type
            },
            body: base64
          });

          const result = await response.json();

          if (result.imageUrl) {
            console.log("üì§ Enviando imageUrl a Wix:", result.imageUrl); // üîç

            window.parent.postMessage({ imageUrl: result.imageUrl }, "*");

            status.innerHTML = `Imagen subida: <a href="${result.imageUrl}" target="_blank">Ver imagen</a>`;
          } else {
            status.textContent = "No se pudo subir la imagen.";
          }

        } catch (error) {
          console.error(error);
          status.textContent = "Error al subir la imagen.";
        }
      };

      reader.readAsDataURL(file);
    });
  </script>
</body>
</html>

